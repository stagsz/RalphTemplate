# HazOp Assistant - Production Environment Configuration
# ============================================================================
# Copy this file to .env.production and fill in production values
# SECURITY: Never commit .env.production to version control!
#
# Usage:
#   1. Copy this file:  cp .env.production.example .env.production
#   2. Edit values:     nano .env.production
#   3. Deploy:          docker compose -f docker-compose.prod.yml --env-file .env.production up -d
# ============================================================================

# =============================================================================
# PROJECT SETTINGS
# =============================================================================

# Project name used for container naming and labels
PROJECT_NAME=hazop

# Docker image version tag
VERSION=latest

# Container registry prefix (e.g., ghcr.io/myorg/, docker.io/mycompany/)
# Leave empty for local builds
REGISTRY=

# =============================================================================
# NETWORK CONFIGURATION
# =============================================================================

# HTTP port for the main application (nginx reverse proxy)
# Change to 443 if terminating SSL at nginx (requires SSL configuration)
HTTP_PORT=80

# Grafana monitoring dashboard port
GRAFANA_PORT=3001

# =============================================================================
# DATABASE (PostgreSQL 15)
# =============================================================================
# SECURITY: Use strong, unique passwords (min 16 characters recommended)
# Generate with: openssl rand -base64 24

DB_USER=hazop_prod
DB_PASSWORD=CHANGE_ME_STRONG_PASSWORD_HERE
DB_NAME=hazop_prod

# Optional: Connection pool settings (adjust based on expected load)
# DB_MAX_CONNECTIONS=20

# =============================================================================
# CACHE (Redis 7)
# =============================================================================
# Redis is configured internally using docker networking
# No external configuration needed for basic setup

# =============================================================================
# OBJECT STORAGE (MinIO - S3 Compatible)
# =============================================================================
# SECURITY: Use strong, unique credentials (min 16 characters)
# Generate with: openssl rand -base64 24

MINIO_ROOT_USER=hazop_minio_admin
MINIO_ROOT_PASSWORD=CHANGE_ME_STRONG_PASSWORD_HERE

# S3 bucket name for P&ID documents and reports
MINIO_BUCKET=hazop-documents

# =============================================================================
# MESSAGE QUEUE (RabbitMQ 3)
# =============================================================================
# SECURITY: Use strong, unique credentials (min 16 characters)
# Generate with: openssl rand -base64 24

RABBITMQ_USER=hazop_rabbit
RABBITMQ_PASSWORD=CHANGE_ME_STRONG_PASSWORD_HERE

# =============================================================================
# AUTHENTICATION (JWT with RS256 Asymmetric Signing)
# =============================================================================
# REQUIRED: Generate a new RSA key pair for production!
#
# Step 1: Generate private key
#   openssl genrsa -out private.pem 2048
#
# Step 2: Extract public key
#   openssl rsa -in private.pem -pubout -out public.pem
#
# Step 3: Convert to single-line format for .env file
#   Linux/macOS:
#     awk 'NF {sub(/\r/, ""); printf "%s\\n",$0;}' private.pem
#     awk 'NF {sub(/\r/, ""); printf "%s\\n",$0;}' public.pem
#
#   Windows PowerShell:
#     (Get-Content private.pem -Raw) -replace "`r`n", "\n" -replace "`n", "\n"
#     (Get-Content public.pem -Raw) -replace "`r`n", "\n" -replace "`n", "\n"
#
# Step 4: Paste the output below (keep the \n escapes)

JWT_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----\nYOUR_PRIVATE_KEY_HERE\n-----END PRIVATE KEY-----
JWT_PUBLIC_KEY=-----BEGIN PUBLIC KEY-----\nYOUR_PUBLIC_KEY_HERE\n-----END PUBLIC KEY-----

# Token expiration settings
# Access tokens: Short-lived for security (default: 15 minutes)
# Refresh tokens: Longer-lived for user convenience (default: 7 days)
JWT_ACCESS_EXPIRY=15m
JWT_REFRESH_EXPIRY=7d

# JWT claims for token validation
JWT_ISSUER=hazop-assistant
JWT_AUDIENCE=hazop-api

# =============================================================================
# LOGGING & MONITORING
# =============================================================================

# Application log level
# Values: error, warn, info, http, verbose, debug, silly
# Production recommendation: info or warn
LOG_LEVEL=info

# =============================================================================
# GRAFANA MONITORING DASHBOARD
# =============================================================================
# SECURITY: Use strong admin credentials (min 16 characters)
# Generate with: openssl rand -base64 24

GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_STRONG_PASSWORD_HERE

# Public URL for Grafana (used for links in alerts, etc.)
# Update to your actual domain when deployed
GRAFANA_ROOT_URL=http://localhost:3001

# =============================================================================
# OPTIONAL: SSL/TLS CONFIGURATION
# =============================================================================
# To enable HTTPS, you'll need to:
# 1. Obtain SSL certificates (Let's Encrypt, commercial CA, etc.)
# 2. Mount certificates in nginx container
# 3. Update nginx config to use default-ssl.conf.template
# 4. Set HTTP_PORT=443
#
# See docker/nginx/default-ssl.conf.template for SSL configuration

# =============================================================================
# OPTIONAL: EXTERNAL SERVICES
# =============================================================================

# Email service for password reset (uncomment and configure if needed)
# SMTP_HOST=smtp.example.com
# SMTP_PORT=587
# SMTP_USER=noreply@example.com
# SMTP_PASSWORD=your_smtp_password
# SMTP_FROM=HazOp Assistant <noreply@example.com>

# =============================================================================
# DEPLOYMENT CHECKLIST
# =============================================================================
# Before deploying to production, ensure you have:
#
# Security:
# [ ] Generated new JWT RSA key pair (don't reuse development keys!)
# [ ] Changed ALL default passwords to strong, unique values
# [ ] Configured firewall rules to restrict internal service ports
# [ ] Set up SSL/TLS for HTTPS (or use a load balancer with SSL termination)
# [ ] Reviewed and hardened nginx security headers
#
# Data Protection:
# [ ] Configured automated database backups
# [ ] Set up volume backup strategy for MinIO (P&ID documents)
# [ ] Tested restore procedures
#
# Operations:
# [ ] Verified all health checks are passing
# [ ] Configured Grafana dashboards and alerts
# [ ] Set up log rotation (handled by Docker by default)
# [ ] Documented recovery procedures
# [ ] Created initial admin user account
#
# Performance:
# [ ] Adjusted resource limits for your server hardware
# [ ] Configured appropriate connection pool sizes
# [ ] Tested under expected load
#
# =============================================================================
# QUICK START
# =============================================================================
# After configuring all values above, deploy with:
#
#   # Pull/build images
#   docker compose -f docker-compose.prod.yml --env-file .env.production build
#
#   # Start services
#   docker compose -f docker-compose.prod.yml --env-file .env.production up -d
#
#   # View logs
#   docker compose -f docker-compose.prod.yml logs -f
#
#   # Check health
#   docker compose -f docker-compose.prod.yml ps
#
#   # Stop services
#   docker compose -f docker-compose.prod.yml down
#
# =============================================================================
